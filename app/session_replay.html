<!DOCTYPE html>
<html>
    <head>
        <title>RUM Integ Test - Session Replay</title>
        <script src="./loader_session_replay.js"></script>
        <link
            rel="icon"
            type="image/png"
            href="https://awsmedia.s3.amazonaws.com/favicon.ico"
        />

        <style>
            table {
                border-collapse: collapse;
                margin-top: 10px;
                margin-bottom: 10px;
            }
            td,
            th {
                border: 1px solid black;
                text-align: left;
                padding: 8px;
            }
            #scrollable {
                width: 200px;
                height: 50px;
                overflow: auto;
                border: 1px solid #ccc;
            }
            #scrollContent {
                height: 300px;
            }
            #canvas {
                border: 1px solid #000;
            }
            .highlight {
                background-color: yellow;
            }
        </style>

        <script>
            // Common to all test pages
            function dispatch() {
                cwr('dispatch');
            }

            function clearRequestResponse() {
                document.getElementById('request_url').innerText = '';
                document.getElementById('request_header').innerText = '';
                document.getElementById('request_body').innerText = '';
                document.getElementById('response_status').innerText = '';
                document.getElementById('response_header').innerText = '';
                document.getElementById('response_body').innerText = '';
            }

            function disable() {
                cwr('disable');
            }

            function enable() {
                cwr('enable');
            }

            // DOM mutation — adds a new element (IncrementalSnapshot: Mutation, source=0)
            function addElement() {
                const el = document.createElement('p');
                el.id = 'dynamicElement';
                el.textContent = 'Dynamically added';
                document.getElementById('mutationTarget').appendChild(el);
            }

            // Style change — modifies inline style (IncrementalSnapshot: StyleDeclaration, source=13)
            function changeStyle() {
                document.getElementById('styleTarget').style.backgroundColor =
                    'red';
                document.getElementById('styleTarget').style.color = 'white';
            }

            // Viewport resize (IncrementalSnapshot: ViewportResize, source=4)
            // Triggered by the test via page.setViewportSize()

            // Scroll (IncrementalSnapshot: Scroll, source=3)
            function scrollElement() {
                document.getElementById('scrollable').scrollTop = 100;
            }

            // Canvas mutation (IncrementalSnapshot: CanvasMutation, source=9)
            function drawCanvas() {
                var canvas = document.getElementById('canvas');
                var ctx = canvas.getContext('2d');
                ctx.fillStyle = 'blue';
                ctx.fillRect(10, 10, 50, 50);
            }

            // Media interaction (IncrementalSnapshot: MediaInteraction, source=7)
            function playMedia() {
                var audio = document.getElementById('audio');
                audio.play().catch(function () {});
            }

            // StyleSheet rule (IncrementalSnapshot: StyleSheetRule, source=8)
            function addStyleRule() {
                var sheet = document.styleSheets[0];
                sheet.insertRule(
                    '.injected { font-weight: bold; }',
                    sheet.cssRules.length
                );
            }

            // Selection (IncrementalSnapshot: Selection, source=14)
            function selectText() {
                var range = document.createRange();
                range.selectNodeContents(
                    document.getElementById('selectTarget')
                );
                var sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }
        </script>
    </head>
    <body>
        <p id="welcome">
            This application is used for RUM session replay integ testing.
        </p>
        <hr />

        <!-- Buttons for DOM interactions -->
        <button id="clickTarget">Click Me</button>
        <button id="addElement" onclick="addElement()">Add Element</button>
        <button id="changeStyle" onclick="changeStyle()">Change Style</button>
        <button id="scrollElement" onclick="scrollElement()">Scroll</button>
        <button id="drawCanvas" onclick="drawCanvas()">Draw Canvas</button>
        <button id="playMedia" onclick="playMedia()">Play Media</button>
        <button id="addStyleRule" onclick="addStyleRule()">
            Add Style Rule
        </button>
        <button id="selectText" onclick="selectText()">Select Text</button>
        <hr />

        <!-- Input for text input events (IncrementalSnapshot: Input, source=5) -->
        <input id="textInput" type="text" placeholder="Type here" />
        <hr />

        <!-- Mutation target -->
        <div id="mutationTarget"></div>

        <!-- Style target -->
        <p id="styleTarget">Style me</p>

        <!-- Scrollable area -->
        <div id="scrollable">
            <div id="scrollContent">Scroll content area</div>
        </div>

        <!-- Canvas -->
        <canvas id="canvas" width="100" height="100"></canvas>

        <!-- Audio for media interaction -->
        <audio
            id="audio"
            src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA="
        ></audio>

        <!-- Selection target -->
        <p id="selectTarget">Select this text</p>

        <hr />
        <button id="disable" onclick="disable()">Disable</button>
        <button id="enable" onclick="enable()">Enable</button>
        <hr />
        <button id="dispatch" onclick="dispatch()">Dispatch</button>
        <button id="clearRequestResponse" onclick="clearRequestResponse()">
            Clear
        </button>
        <hr />
        <span id="request"></span>
        <span id="response"></span>
        <table>
            <tr>
                <td>Request URL</td>
                <td id="request_url"></td>
            </tr>
            <tr>
                <td>Request Header</td>
                <td id="request_header"></td>
            </tr>
            <tr>
                <td>Request Body</td>
                <td id="request_body"></td>
            </tr>
        </table>
        <table>
            <tr>
                <td>Response Status Code</td>
                <td id="response_status"></td>
            </tr>
            <tr>
                <td>Response Header</td>
                <td id="response_header"></td>
            </tr>
            <tr>
                <td>Response Body</td>
                <td id="response_body"></td>
            </tr>
        </table>
    </body>
</html>
